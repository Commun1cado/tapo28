<!DOCTYPE html>
<html>
<head>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { 
  margin:0; padding:10px; 
  background:url('tarot-bg.jpg') center/cover fixed; 
  font-family:system-ui; 
  display:flex; flex-direction:column; 
  align-items:center; justify-content:center; 
  gap:20px; min-height:100vh;
  padding-top: 60px;
  padding-bottom: 80px;
  box-sizing: border-box;
}
.title {
  font-size:24px;
  font-weight:bold;
  color:#000;
  text-shadow:2px 2px 4px rgba(255,255,255,0.5);
  margin-top:20px;
}
.grid { 
  display:grid; 
  grid-template-columns:repeat(3, 1fr); 
  gap:10px;
  width:85vw;
  max-width:380px;
}
.card-container {
  perspective:1000px;
  width:100%;
  aspect-ratio:295/510;
  position:relative;
}
.card {
  width:100%;
  height:100%;
  position:relative;
  transition:transform 0.6s;
  transform-style:preserve-3d;
  cursor:pointer;
}
.card.flipped {
  transform:rotateY(180deg);
}
.card-front, .card-back {
  position:absolute;
  width:100%;
  height:100%;
  backface-visibility:hidden;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,0.5);
  border:2px solid rgba(255,255,255,0.3);
  display:flex;
  align-items:center;
  justify-content:center;
  background-size:cover;
  background-repeat:no-repeat;
  background-position:center;
}
.card-front {
  background-image:url('cards/card-back.jpg');
  background-color:#2a1a4a;
  background-size:contain;
  background-repeat:no-repeat;
  background-position:center;
}
.card-back {
  background-color:#1a1a1a;
  transform:rotateY(180deg);
  box-shadow:inset 0 0 20px rgba(0,0,0,0.4);
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –∫ —Ü–µ–Ω—Ç—Ä—É –ø—Ä–∏ –≤—ã–±–æ—Ä–µ */
@keyframes zoomToCenter {
  0% {
    transform:scale(1);
    z-index:1000;
  }
  50% {
    transform:scale(1.5);
    z-index:1000;
  }
  100% {
    transform:scale(2.2) translateY(var(--centerOffsetY, 0)) translateX(var(--centerOffsetX, 0));
    z-index:1000;
  }
}
@keyframes moveBack {
  0% {
    transform:scale(2.2) translateY(var(--centerOffsetY, 0)) translateX(var(--centerOffsetX, 0));
    z-index:1000;
  }
  100% {
    transform:scale(1) translateY(0) translateX(0);
    z-index:1;
  }
}

/* –§–∏–Ω–∞–ª—å–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è ‚Äì —Å–æ–±–∏—Ä–∞–µ–º 3 –∫–∞—Ä—Ç—ã –≤ –†–Ø–î –ø–æ —Ü–µ–Ω—Ç—Ä—É (2-—è –∫–∞—Ä—Ç–∞ 2-–≥–æ —Ä—è–¥–∞) */
@keyframes finalArrange {
  0% {
    transform:translate(-50%, -50%) scale(0.8);
    opacity:0;
  }
  60% {
    transform:translate(-50%, -50%) scale(1);
    opacity:1;
  }
  100% {
    transform:translate(-50%, -50%) scale(0.9);
    opacity:1;
  }
}

/* –ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç */
@keyframes fadeOut {
  0% {
    opacity:1;
  }
  100% {
    opacity:0;
  }
}

.card-container.animate-zoom {
  animation:zoomToCenter 0.8s ease-out forwards;
}
.card-container.animate-back {
  animation:moveBack 0.6s ease-in forwards;
}

/* –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä—è–¥ —Ç–æ—á–Ω–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤—Ç–æ—Ä–æ–π –∫–∞—Ä—Ç—ã –≤—Ç–æ—Ä–æ–≥–æ —Ä—è–¥–∞ - —Å–¥–≤–∏–≥ –≤–ª–µ–≤–æ */
.final-row-wrapper {
  position:fixed;
  top: 50%;
  left: calc(50% - 15px); /* –°–¥–≤–∏–≥ –≤–ª–µ–≤–æ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
  transform: translate(-50%, -50%);
  display:flex;
  flex-direction: row;
  gap:12px;
  z-index:2000;
  align-items: center;
  justify-content: center;
}
.final-row-wrapper .card-container {
  position:static !important;
  width:120px !important;
  height:200px !important;
  flex-shrink:0;
  flex-grow:0;
}
.final-row-wrapper .card-container.animate-final {
  animation:finalArrange 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

/* Fade –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ */
.card-container.fade-out {
  animation:fadeOut 0.6s ease-out forwards;
}

@media (min-width:600px) {
  .final-row-wrapper {
    left: calc(50% - 12px); /* –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –±–æ–ª—å—à–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
  }
  .title {
    font-size:28px;
  }
  .grid { 
    width:65vw;
    max-width:330px;
    gap:10px;
  }
  .card:hover:not(.disabled) { 
    transform:translateY(-15px) scale(1.05);
  }
  .card.flipped:hover:not(.disabled) {
    transform:rotateY(180deg) translateY(-15px) scale(1.05);
  }
  .final-row-wrapper .card-container {
    width:110px !important;
    height:185px !important;
  }
}
.disabled {
  pointer-events:none;
}
</style>
</head>
<body>
<div class="title">–í—ã–±–µ—Ä–∏—Ç–µ 3 –∫–∞—Ä—Ç—ã</div>
<div class="grid" id="grid"></div>

<script>
const allCards = [
  'cards/00-TheFool.jpg', 'cards/01-TheMagician.jpg', 'cards/02-TheHighPriestess.jpg',
  'cards/03-TheEmpress.jpg', 'cards/04-TheEmperor.jpg', 'cards/05-TheHierophant.jpg',
  'cards/06-TheLovers.jpg', 'cards/07-TheChariot.jpg', 'cards/08-Strength.jpg',
  'cards/09-TheHermit.jpg', 'cards/10-WheelOfFortune.jpg', 'cards/11-Justice.jpg',
  'cards/12-TheHangedMan.jpg', 'cards/13-Death.jpg', 'cards/14-Temperance.jpg',
  'cards/15-TheDevil.jpg', 'cards/16-TheTower.jpg', 'cards/17-TheStar.jpg',
  'cards/18-TheMoon.jpg', 'cards/19-TheSun.jpg', 'cards/20-Judgement.jpg',
  'cards/21-TheWorld.jpg',
  'cards/Cups01.jpg', 'cards/Cups02.jpg', 'cards/Cups03.jpg', 'cards/Cups04.jpg',
  'cards/Cups05.jpg', 'cards/Cups06.jpg', 'cards/Cups07.jpg', 'cards/Cups08.jpg',
  'cards/Cups09.jpg', 'cards/Cups10.jpg', 'cards/Cups11.jpg', 'cards/Cups12.jpg',
  'cards/Cups13.jpg', 'cards/Cups14.jpg',
  'cards/Pentacles01.jpg', 'cards/Pentacles02.jpg', 'cards/Pentacles03.jpg', 'cards/Pentacles04.jpg',
  'cards/Pentacles05.jpg', 'cards/Pentacles06.jpg', 'cards/Pentacles07.jpg', 'cards/Pentacles08.jpg',
  'cards/Pentacles09.jpg', 'cards/Pentacles10.jpg', 'cards/Pentacles11.jpg', 'cards/Pentacles12.jpg',
  'cards/Pentacles13.jpg', 'cards/Pentacles14.jpg',
  'cards/Swords01.jpg', 'cards/Swords02.jpg', 'cards/Swords03.jpg', 'cards/Swords04.jpg',
  'cards/Swords05.jpg', 'cards/Swords06.jpg', 'cards/Swords07.jpg', 'cards/Swords08.jpg',
  'cards/Swords09.jpg', 'cards/Swords10.jpg', 'cards/Swords11.jpg', 'cards/Swords12.jpg',
  'cards/Swords13.jpg', 'cards/Swords14.jpg',
  'cards/Wands01.jpg', 'cards/Wands02.jpg', 'cards/Wands03.jpg', 'cards/Wands04.jpg',
  'cards/Wands05.jpg', 'cards/Wands06.jpg', 'cards/Wands07.jpg', 'cards/Wands08.jpg',
  'cards/Wands09.jpg', 'cards/Wands10.jpg', 'cards/Wands11.jpg', 'cards/Wands12.jpg',
  'cards/Wands13.jpg', 'cards/Wands14.jpg'
];

const grid = document.getElementById('grid');
const containers = [];
let selectedCount = 0;
let selectedIndices = [];

for (let i = 0; i < 9; i++) {
  const container = document.createElement('div');
  container.className = 'card-container';
  container.id = `card-${i}`;
  
  const card = document.createElement('div');
  card.className = 'card';
  
  const front = document.createElement('div');
  front.className = 'card-front';
  
  const back = document.createElement('div');
  back.className = 'card-back';
  
  card.appendChild(front);
  card.appendChild(back);
  container.appendChild(card);
  
  containers.push(container);
  container.onclick = () => flipCard(card, container, i);
  grid.appendChild(container);
}

function getRandomCard() {
  return allCards[Math.floor(Math.random() * allCards.length)];
}

function calculateOffset(cardIndex, centerIndex = 4) { // 4 = 2-—è –∫–∞—Ä—Ç–∞ 2-–≥–æ —Ä—è–¥–∞ (–∏–Ω–¥–µ–∫—Å—ã 0-8)
  const centerContainer = containers[centerIndex];
  const cardContainer = containers[cardIndex];
  
  const centerRect = centerContainer.getBoundingClientRect();
  const cardRect = cardContainer.getBoundingClientRect();
  
  const offsetX = centerRect.left - cardRect.left;
  const offsetY = centerRect.top - cardRect.top;
  
  return { offsetX, offsetY };
}

function finalArrangement() {
  // –°–µ—Ç–∫–∞ —É—Ö–æ–¥–∏—Ç –≤ —Ñ–æ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤—Ç–æ—Ä–æ–π –∫–∞—Ä—Ç—ã –≤—Ç–æ—Ä–æ–≥–æ —Ä—è–¥–∞
  grid.style.opacity = '0';
  
  // –û–±—ë—Ä—Ç–∫–∞ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä—è–¥–∞
  const wrapper = document.createElement('div');
  wrapper.className = 'final-row-wrapper';
  document.body.appendChild(wrapper);
  
  // –ü–µ—Ä–µ–Ω–æ—Å–∏–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤–Ω—É—Ç—Ä—å –æ–±—ë—Ä—Ç–∫–∏
  selectedIndices.forEach((index, pos) => {
    const container = containers[index];
    wrapper.appendChild(container);
    
    // –ù–µ–º–Ω–æ–≥–æ –ø–æ–æ—á–µ—Ä—ë–¥–Ω—ã–π –≤—Ö–æ–¥
    setTimeout(() => {
      container.classList.add('animate-final');
    }, pos * 150);
  });
  
  setTimeout(() => {
    Telegram.WebApp.close();
  }, 3200);
}

function flipCard(cardEl, containerEl, index) {
  if (cardEl.classList.contains('disabled')) return;
  if (selectedCount === 3) return;
  
  cardEl.classList.add('disabled');
  
  const randomCard = getRandomCard();
  const backEl = cardEl.querySelector('.card-back');
  backEl.style.backgroundImage = `url('${randomCard}')`;
  Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
  
  setTimeout(() => {
    cardEl.classList.add('flipped');
  }, 300);
  
  setTimeout(() => {
    const offset = calculateOffset(index, 4); // –¶–µ–Ω—Ç—Ä = –∏–Ω–¥–µ–∫—Å 4
    containerEl.style.setProperty('--centerOffsetX', `${offset.offsetX * 0.3}px`);
    containerEl.style.setProperty('--centerOffsetY', `${offset.offsetY * 0.3}px`);
    containerEl.classList.add('animate-zoom');
  }, 300);
  
  setTimeout(() => {
    containerEl.classList.remove('animate-zoom');
    containerEl.classList.add('animate-back');
  }, 1100);
  
  setTimeout(() => {
    containerEl.classList.remove('animate-back');
    cardEl.classList.remove('disabled');
    selectedCount++;
    selectedIndices.push(index);
    
    if (selectedCount === 3) {
      setTimeout(() => {
        finalArrangement();
      }, 500);
    }
  }, 1700);
}

Telegram.WebApp.ready();
Telegram.WebApp.expand();

Telegram.WebApp.MainButton.text = 'üîÆ –ù–æ–≤–æ–µ –≥–∞–¥–∞–Ω–∏–µ';
Telegram.WebApp.MainButton.color = '#6a0dad';
Telegram.WebApp.MainButton.textColor = 'white';
Telegram.WebApp.MainButton.onClick(() => location.reload());
Telegram.WebApp.MainButton.show();
</script>
</body>
</html>
