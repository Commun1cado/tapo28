<!DOCTYPE html>
<html>
<head>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body { 
  margin:0; padding:10px; 
  background:url('tarot-bg.jpg') center/cover fixed; 
  font-family:system-ui; 
  display:flex; flex-direction:column; 
  align-items:center; justify-content:center; 
  gap:20px; min-height:100vh;
}
.title {
  font-size:24px;
  font-weight:bold;
  color:#000;
  text-shadow:2px 2px 4px rgba(255,255,255,0.5);
  margin-top:20px;
}
.grid { 
  display:grid; 
  grid-template-columns:repeat(3, 1fr); 
  gap:10px;
  width:85vw;
  max-width:380px;
}
.card-container {
  perspective:1000px;
  width:100%;
  aspect-ratio:2/3;
  position:relative;
}
.card {
  width:100%;
  height:100%;
  position:relative;
  transition:transform 0.6s;
  transform-style:preserve-3d;
  cursor:pointer;
}
.card.flipped {
  transform:rotateY(180deg);
}
.card-front, .card-back {
  position:absolute;
  width:100%;
  height:100%;
  backface-visibility:hidden;
  border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,0.5);
  border:2px solid rgba(255,255,255,0.3);
  display:flex;
  align-items:center;
  justify-content:center;
  background-size:cover;
  background-repeat:no-repeat;
  background-position:center;
}
.card-front {
  background-image:url('cards/card-back.jpg');
  background-color:#2a1a4a;
}
.card-back {
  background-color:#1a1a1a;
  transform:rotateY(180deg);
  box-shadow:inset 0 0 20px rgba(0,0,0,0.4);
}
@keyframes zoomToCenter {
  0% {
    transform:scale(1);
    z-index:1000;
  }
  50% {
    transform:scale(1.5);
    z-index:1000;
  }
  100% {
    transform:scale(2.2) translateY(-8vh) translateX(var(--centerOffsetX, 0));
    z-index:1000;
  }
}
@keyframes moveBack {
  0% {
    transform:scale(2.2) translateY(-8vh) translateX(var(--centerOffsetX, 0));
    z-index:1000;
  }
  100% {
    transform:scale(1) translateY(0) translateX(0);
    z-index:1;
  }
}
.card-container.animate-zoom {
  animation:zoomToCenter 0.8s ease-out forwards;
}
.card-container.animate-back {
  animation:moveBack 0.6s ease-in forwards;
}
.selected-cards {
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
  z-index:100;
}
.selected-card-badge {
  background:#6a0dad;
  color:white;
  padding:8px 12px;
  border-radius:20px;
  font-size:12px;
  font-weight:bold;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
}
.submit-btn {
  position:fixed;
  bottom:80px;
  left:50%;
  transform:translateX(-50%);
  padding:12px 24px;
  background:#6a0dad;
  color:white;
  border:none;
  border-radius:8px;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,0.3);
  display:none;
  z-index:100;
}
.submit-btn.show {
  display:block;
}
.submit-btn:active {
  transform:translateX(-50%) scale(0.95);
}
@media (min-width:600px) {
  .title {
    font-size:28px;
  }
  .grid { 
    width:90vw;
    max-width:450px;
    gap:15px;
  }
  .card:hover:not(.disabled) { 
    transform:translateY(-15px) scale(1.05);
  }
  .card.flipped:hover:not(.disabled) {
    transform:rotateY(180deg) translateY(-15px) scale(1.05);
  }
}
.disabled {
  pointer-events:none;
}
</style>
</head>
<body>
<div class="title">–í—ã–±–µ—Ä–∏—Ç–µ 3 –∫–∞—Ä—Ç—ã</div>
<div class="grid" id="grid"></div>
<div class="selected-cards" id="selectedCards"></div>
<button class="submit-btn" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–∞–¥–∞–Ω–∏–µ</button>

<script>
const allCards = {
  'cards/00-TheFool.jpg': '–®—É—Ç',
  'cards/01-TheMagician.jpg': '–ú–∞–≥',
  'cards/02-TheHighPriestess.jpg': '–ñ—Ä–∏—Ü–∞',
  'cards/03-TheEmpress.jpg': '–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞',
  'cards/04-TheEmperor.jpg': '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä',
  'cards/05-TheHierophant.jpg': '–ò–µ—Ä–æ—Ñ–∞–Ω—Ç',
  'cards/06-TheLovers.jpg': '–í–ª—é–±–ª–µ–Ω–Ω—ã–µ',
  'cards/07-TheChariot.jpg': '–ö–æ–ª–µ—Å–Ω–∏—Ü–∞',
  'cards/08-Strength.jpg': '–°–∏–ª–∞',
  'cards/09-TheHermit.jpg': '–û—Ç—à–µ–ª—å–Ω–∏–∫',
  'cards/10-WheelOfFortune.jpg': '–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã',
  'cards/11-Justice.jpg': '–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å',
  'cards/12-TheHangedMan.jpg': '–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π',
  'cards/13-Death.jpg': '–°–º–µ—Ä—Ç—å',
  'cards/14-Temperance.jpg': '–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å',
  'cards/15-TheDevil.jpg': '–î—å—è–≤–æ–ª',
  'cards/16-TheTower.jpg': '–ë–∞—à–Ω—è',
  'cards/17-TheStar.jpg': '–ó–≤–µ–∑–¥–∞',
  'cards/18-TheMoon.jpg': '–õ—É–Ω–∞',
  'cards/19-TheSun.jpg': '–°–æ–ª–Ω—Ü–µ',
  'cards/20-Judgement.jpg': '–°—É–¥',
  'cards/21-TheWorld.jpg': '–ú–∏—Ä',
  'cards/Cups01.jpg': '–¢—É–∑ –ö—É–±–∫–æ–≤',
  'cards/Cups02.jpg': '–î–≤–æ–π–∫–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups03.jpg': '–¢—Ä–æ–π–∫–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups04.jpg': '–ß–µ—Ç–≤—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups05.jpg': '–ü—è—Ç—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups06.jpg': '–®–µ—Å—Ç—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups07.jpg': '–°–µ–º—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups08.jpg': '–í–æ—Å—å–º—ë—Ä–∫–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups09.jpg': '–î–µ–≤—è—Ç–∫–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups10.jpg': '–î–µ—Å—è—Ç–∫–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups11.jpg': '–ü–∞–∂ –ö—É–±–∫–æ–≤',
  'cards/Cups12.jpg': '–†—ã—Ü–∞—Ä—å –ö—É–±–∫–æ–≤',
  'cards/Cups13.jpg': '–ö–æ—Ä–æ–ª–µ–≤–∞ –ö—É–±–∫–æ–≤',
  'cards/Cups14.jpg': '–ö–æ—Ä–æ–ª—å –ö—É–±–∫–æ–≤',
  'cards/Pentacles01.jpg': '–¢—É–∑ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles02.jpg': '–î–≤–æ–π–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles03.jpg': '–¢—Ä–æ–π–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles04.jpg': '–ß–µ—Ç–≤—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles05.jpg': '–ü—è—Ç—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles06.jpg': '–®–µ—Å—Ç—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles07.jpg': '–°–µ–º—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles08.jpg': '–í–æ—Å—å–º—ë—Ä–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles09.jpg': '–î–µ–≤—è—Ç–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles10.jpg': '–î–µ—Å—è—Ç–∫–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles11.jpg': '–ü–∞–∂ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles12.jpg': '–†—ã—Ü–∞—Ä—å –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles13.jpg': '–ö–æ—Ä–æ–ª–µ–≤–∞ –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Pentacles14.jpg': '–ö–æ—Ä–æ–ª—å –ü–µ–Ω—Ç–∞–∫–ª–µ–π',
  'cards/Swords01.jpg': '–¢—É–∑ –ú–µ—á–µ–π',
  'cards/Swords02.jpg': '–î–≤–æ–π–∫–∞ –ú–µ—á–µ–π',
  'cards/Swords03.jpg': '–¢—Ä–æ–π–∫–∞ –ú–µ—á–µ–π',
  'cards/Swords04.jpg': '–ß–µ—Ç–≤—ë—Ä–∫–∞ –ú–µ—á–µ–π',
  'cards/Swords05.jpg': '–ü—è—Ç—ë—Ä–∫–∞ –ú–µ—á–µ–π',
  'cards/Swords06.jpg': '–®–µ—Å—Ç—ë—Ä–∫–∞ –ú–µ—á–µ–π',
  'cards/Swords07.jpg': '–°–µ–º—ë—Ä–∫–∞ –ú–µ—á–µ–π',
  'cards/Swords08.jpg': '–í–æ—Å—å–º—ë—Ä–∫–∞ –ú–µ—á–µ–π',
  'cards/Swords09.jpg': '–î–µ–≤—è—Ç–∫–∞ –ú–µ—á–µ–π',
  'cards/Swords10.jpg': '–î–µ—Å—è—Ç–∫–∞ –ú–µ—á–µ–π',
  'cards/Swords11.jpg': '–ü–∞–∂ –ú–µ—á–µ–π',
  'cards/Swords12.jpg': '–†—ã—Ü–∞—Ä—å –ú–µ—á–µ–π',
  'cards/Swords13.jpg': '–ö–æ—Ä–æ–ª–µ–≤–∞ –ú–µ—á–µ–π',
  'cards/Swords14.jpg': '–ö–æ—Ä–æ–ª—å –ú–µ—á–µ–π',
  'cards/Wands01.jpg': '–¢—É–∑ –ü–∞–ª–∏—Ü',
  'cards/Wands02.jpg': '–î–≤–æ–π–∫–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands03.jpg': '–¢—Ä–æ–π–∫–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands04.jpg': '–ß–µ—Ç–≤—ë—Ä–∫–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands05.jpg': '–ü—è—Ç—ë—Ä–∫–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands06.jpg': '–®–µ—Å—Ç—ë—Ä–∫–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands07.jpg': '–°–µ–º—ë—Ä–∫–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands08.jpg': '–í–æ—Å—å–º—ë—Ä–∫–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands09.jpg': '–î–µ–≤—è—Ç–∫–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands10.jpg': '–î–µ—Å—è—Ç–∫–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands11.jpg': '–ü–∞–∂ –ü–∞–ª–∏—Ü',
  'cards/Wands12.jpg': '–†—ã—Ü–∞—Ä—å –ü–∞–ª–∏—Ü',
  'cards/Wands13.jpg': '–ö–æ—Ä–æ–ª–µ–≤–∞ –ü–∞–ª–∏—Ü',
  'cards/Wands14.jpg': '–ö–æ—Ä–æ–ª—å –ü–∞–ª–∏—Ü'
};

const cardNames = Object.values(allCards);
const grid = document.getElementById('grid');
const containers = [];
const selectedCardsDiv = document.getElementById('selectedCards');
const submitBtn = document.getElementById('submitBtn');
let selectedCards = [];

for (let i = 0; i < 9; i++) {
  const container = document.createElement('div');
  container.className = 'card-container';
  container.id = `card-${i}`;
  
  const card = document.createElement('div');
  card.className = 'card';
  
  const front = document.createElement('div');
  front.className = 'card-front';
  
  const back = document.createElement('div');
  back.className = 'card-back';
  
  card.appendChild(front);
  card.appendChild(back);
  container.appendChild(card);
  
  containers.push(container);
  container.onclick = () => flipCard(card, container, i);
  grid.appendChild(container);
}

function getRandomCard() {
  return cardNames[Math.floor(Math.random() * cardNames.length)];
}

function calculateOffset(cardIndex, centerIndex = 4) {
  const centerContainer = containers[centerIndex];
  const cardContainer = containers[cardIndex];
  
  const centerRect = centerContainer.getBoundingClientRect();
  const cardRect = cardContainer.getBoundingClientRect();
  
  const offsetX = centerRect.left - cardRect.left;
  
  return { offsetX };
}

function updateSelectedCards() {
  selectedCardsDiv.innerHTML = '';
  selectedCards.forEach(card => {
    const badge = document.createElement('div');
    badge.className = 'selected-card-badge';
    badge.textContent = card;
    selectedCardsDiv.appendChild(badge);
  });
  
  if (selectedCards.length === 3) {
    submitBtn.classList.add('show');
  } else {
    submitBtn.classList.remove('show');
  }
}

function flipCard(cardEl, containerEl, index) {
  if (cardEl.classList.contains('disabled')) return;
  if (selectedCards.length === 3 && !cardEl.classList.contains('flipped')) return;
  
  cardEl.classList.add('disabled');
  
  if (!cardEl.classList.contains('flipped')) {
    const randomCard = getRandomCard();
    const backEl = cardEl.querySelector('.card-back');
    backEl.style.backgroundImage = `url('${randomCard}')`;
    backEl.dataset.cardName = randomCard;
    Telegram.WebApp.HapticFeedback.impactOccurred('heavy');
    
    setTimeout(() => {
      cardEl.classList.add('flipped');
    }, 300);
    
    setTimeout(() => {
      const offset = calculateOffset(index, 4);
      containerEl.style.setProperty('--centerOffsetX', `${offset.offsetX * 0.3}px`);
      containerEl.classList.add('animate-zoom');
    }, 300);
    
    setTimeout(() => {
      containerEl.classList.remove('animate-zoom');
      containerEl.classList.add('animate-back');
    }, 1100);
    
    setTimeout(() => {
      containerEl.classList.remove('animate-back');
      cardEl.classList.remove('disabled');
      selectedCards.push(randomCard);
      updateSelectedCards();
    }, 1700);
  } else {
    const backEl = cardEl.querySelector('.card-back');
    const cardName = backEl.dataset.cardName;
    selectedCards = selectedCards.filter(c => c !== cardName);
    cardEl.classList.remove('flipped');
    cardEl.classList.remove('disabled');
    backEl.style.backgroundImage = '';
    updateSelectedCards();
  }
}

submitBtn.onclick = () => {
  const message = `üîÆ –í–∞—à–µ –≥–∞–¥–∞–Ω–∏–µ:\n\n${selectedCards.map((card, i) => `${i + 1}. ${card}`).join('\n')}`;
  
  Telegram.WebApp.sendData(message);
  Telegram.WebApp.close();
};

Telegram.WebApp.ready();
Telegram.WebApp.expand();

Telegram.WebApp.MainButton.text = 'üîÆ –ù–æ–≤–æ–µ –≥–∞–¥–∞–Ω–∏–µ';
Telegram.WebApp.MainButton.color = '#6a0dad';
Telegram.WebApp.MainButton.textColor = 'white';
Telegram.WebApp.MainButton.onClick(() => location.reload());
Telegram.WebApp.MainButton.show();
</script>
</body>
</html>
